<div class="folders-container">
  <div class="header-container">
    <h3>Folders : {{ dataSource.length }}</h3>
  </div>

  <div class="spinner" *ngIf="isLoading && !error">
    <mat-spinner></mat-spinner>
  </div>

  <div class="header-container-2">
    <div class="left-section">
      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Search</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Dev" #input>
      </mat-form-field>
    </div>

    <div class="right-section">
      <button mat-button (click)="deleteSelection()" *ngIf="selection.hasValue() && isChecked">
        Delete
        <mat-icon class="delete-icon">delete_forever</mat-icon>
      </button>
      <div class="select-all" *ngIf="isChecked">
        Select all :
        <mat-checkbox
          (change)="$event ? toggleAllGrid() : null"
          [checked]="selection.hasValue() && isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()"
          [aria-label]="checkboxLabel()">
        </mat-checkbox>
      </div>
      <mat-slide-toggle class="example-margin" [(ngModel)]="isChecked" (click)="checkedClick()">Select</mat-slide-toggle>

      <button mat-button class="add-folder" (click)="openAddFolder()"><mat-icon>add</mat-icon></button>

    </div>
  </div>


  <ng-container *ngIf="!isLoading && dataSource && dataSource.length > 0 && !error">

    <div class="content">
      <div fxLayout="row wrap" fxLayoutGap="grid" class="grid-container">
        <div [fxFlex]="(100 / gridColumns) + '%'"
             [fxFlex.xs]="100 + '%'"
             [fxFlex.sm]="(100 / 4) + '%'"
             [fxFlex.md]="(100 / 5) + '%'"
             [fxFlex.lg]="(100 / 8) + '%'"
             [fxFlex.xl]="(100 / 11) + '%'"
             [fxFlex.gt-xs]="(100 / 3) + '%'"
             [fxFlex.gt-sm]="(100 / 5) + '%'"
             [fxFlex.gt-md]="(100 / 5) + '%'"
             [fxFlex.gt-lg]="(100 / 6) + '%'"
             [fxFlex.lt-sm]="(100 / 2) + '%'"
             [fxFlex.lt-md]="(100 / 3) + '%'"
             [fxFlex.lt-lg]="(100 / 4) + '%'"
             [fxFlex.lt-xl]="(100 / 6) + '%'"

             *ngFor="let folder of dataSource">
          <mat-card class="mat-elevation-z4" (dblclick)="handleCardClick(folder.id)">
            <div class="checkbox-container" (click)="$event.stopPropagation()" *ngIf="isChecked">
              <mat-checkbox (change)="$event ? toggleSelection(folder.id) : null"
                            [checked]="selection.isSelected(folder.id)"
                            [aria-label]="checkboxLabel(folder.id)">
              </mat-checkbox>
            </div>
            <div class="checkbox-container" (click)="$event.stopPropagation()" *ngIf="!isChecked">
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="rename(folder)">
                  <mat-icon>mode_edit</mat-icon>
                  <span>Rename</span>
                </button>

                <!-- Menu avec sous-menu pour "Delete" -->
                <button mat-menu-item [matMenuTriggerFor]="deleteMenu">
                  <mat-icon>delete_forever</mat-icon>
                  <span>Delete</span>
                </button>

                <button mat-menu-item (click)="transfer(folder.id)" [disabled]="folder.fileCount === 0">
                  <mat-icon>subdirectory_arrow_right</mat-icon>
                  <span>Transfer</span>
                </button>
              </mat-menu>

              <!-- Sous-menu pour "Delete" -->
              <mat-menu #deleteMenu="matMenu">
                <button mat-menu-item (click)="transferToDelete(folder.id)" [disabled]="folder.fileCount === 0">
                  <span>Transfer and Delete</span>
                </button>
                <button mat-menu-item (click)="deleteAllFiles(folder.id)">
                  <span *ngIf="folder.fileCount === 0">Delete</span>
                  <span *ngIf="folder.fileCount !== 0">Delete with all files</span>
                </button>
              </mat-menu>

            </div>

            <img mat-card-image src="/assets/images/folder.svg" alt="pdf photos" class="image-pdf"/>
            <div class="card-actions">
              <span class="word-count">{{ folder.fileCount }} </span>
              <span class="word" style="margin-top: 15px">{{ folder.createdAt | date: 'yyyy-MM-dd' }}</span>
            </div>
            <div class="name-folder">
              <span class="word-action">{{ folder.name }}</span>
            </div>
          </mat-card>
        </div>

      </div>
    </div>
  </ng-container>
  <ng-container *ngIf="error">
    <span class="error-message">{{ error }}</span>
  </ng-container>
  <!--Si le datasource est vide(n'a pas d'elements)-->
  <ng-container *ngIf="!isLoading && dataSource && dataSource.length === 0 && !error">
    <span class="error-message">No data available</span>
  </ng-container>

</div>
